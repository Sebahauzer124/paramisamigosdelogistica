<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Descarga de Datos CloudFleet</title>
    <style>
        body { font-family: Arial; background: #f0f0f0; padding: 20px; }
        button { margin: 10px; padding: 10px 20px; font-size: 16px; }
        input[type="date"] { font-size: 16px; padding: 5px; }
        #log { margin-top: 20px; background: #fff; padding: 10px; border: 1px solid #ccc; }
        a.descargar { display: none; margin: 10px 0; font-weight: bold; }
    </style>
</head>
<body>

    <h1>Exportaci√≥n desde CloudFleet</h1>

    <button onclick="ejecutar('combustible')">Descargar Veh√≠culos</button>
    <a id="linkDescargaCombustible" class="descargar" href="#" download>üì• Descargar Veh√≠culos Excel</a>

    <h3>Exportar Checklists</h3>
    <label>Fecha √∫nica:</label>
    <input type="date" id="fechaChecklist">
    <br><br>
    <label>O bien Rango de fechas:</label><br>
    Desde: <input type="date" id="fechaDesde">
    Hasta: <input type="date" id="fechaHasta">
    <br>
    <button onclick="exportarChecklist()">Descargar Checklists</button>
    <a id="linkDescargaChecklist" class="descargar" href="#" download>üì• Descargar Checklists Excel</a>

    <div id="log">Esperando acciones...</div>

    <script>
        function ejecutar(tipo) {
            document.getElementById('log').innerText = `‚è≥ Ejecutando ${tipo}...`;
            const linkDescarga = document.getElementById('linkDescargaCombustible');
            linkDescarga.style.display = 'none';

            fetch(`/ejecutar/${tipo}`)
                .then(res => res.text())
                .then(msg => {
                    document.getElementById('log').innerText = msg;
                    if (tipo === 'combustible') {
                        linkDescarga.href = '/descargar/combustible';
                        linkDescarga.style.display = 'inline-block';
                    }
                })
                .catch(() => {
                    document.getElementById('log').innerText = '‚ùå Error ejecutando el proceso.';
                });
        }

        function exportarChecklist() {
            const fecha = document.getElementById('fechaChecklist').value;
            const desde = document.getElementById('fechaDesde').value;
            const hasta = document.getElementById('fechaHasta').value;
            const linkDescarga = document.getElementById('linkDescargaChecklist');
            linkDescarga.style.display = 'none';

            let url = '/ejecutar/checklist?';

            let descargaUrl = '/descargar/checklist?';

            if (desde && hasta) {
                url += `desde=${desde}&hasta=${hasta}`;
                descargaUrl += `desde=${desde}&hasta=${hasta}`;
            } else if (fecha) {
                url += `fecha=${fecha}`;
                descargaUrl += `desde=${fecha}&hasta=${fecha}`;
            } else {
                document.getElementById('log').innerText = '‚ö†Ô∏è Seleccion√° una fecha o un rango antes de exportar.';
                return;
            }

            document.getElementById('log').innerText = '‚è≥ Exportando checklists...';

            fetch(url)
                .then(res => res.text())
                .then(msg => {
                    document.getElementById('log').innerText = msg;
                    linkDescarga.href = descargaUrl;
                    linkDescarga.style.display = 'inline-block';
                })
                .catch(() => {
                    document.getElementById('log').innerText = '‚ùå Error ejecutando el proceso.';
                });
        }
    </script>

</body>
</html>
